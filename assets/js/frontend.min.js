// Get data from admin

var jseacgpD = jseacgpData;

(function( $ ) {
	$(document).ready(function(){

		$('form#admitDform').submit(function(e){
			e.preventDefault();

			//var rtype = jseacgpD.fType;
			var rtype =  "form2"
			var exam = $('#jseacgpExam').val();
			var year = $('#jseacgpYear').val();
			var roll = $('#jseacgpRoll').val();
			var reg = $('#jseacgpReg').val();
			var birthdate = $('#jseacgpDobrith').val();
			var loader = $('p.jseacgpLoader');
			var ajaxMessage = $('div.jseacgpMessage');

			// Validate date format

			var regex = /(((0|1)[0-9]|2[0-9]|3[0-1])\/(0[1-9]|1[0-2])\/((19|20)\d\d))$/;

			if (regex.test(birthdate)) {
				
				// Now Do ajax call
			
				$.ajax({
					type: 'GET',
					url:  jseacgpD.ajaxUrl,
					data: {
						action: 'jseacgp_pdfdl',
						generate: 'no',
						exam: exam,
						year: year,
						roll: roll,
						reg: reg,
						birthdate: birthdate
					},
					
					// If Success it will be executed
					
					success: function(data){
						
						if( data > 0 ){
							
							loader.hide();
							// Send request based on download form

							if(rtype === 'form1'){
								var reqLocation = jseacgpD.ajaxUrl+"?action=jseacgp_pdfdl&generate=yes&exam="+exam+"&year="+year+"&roll="+roll+"";
								ajaxMessage.html('<p class="jseacgpSuccess">'+jseacgpD.aSmessage+' <a href="'+reqLocation+'">Click here</a> if download not started automatically.</p>');
								document.location = reqLocation;
							}

							if(rtype === 'form2'){
								var reqLocation = jseacgpD.ajaxUrl+"?action=jseacgp_pdfdl&generate=yes&exam="+exam+"&year="+year+"&birthdate="+birthdate+"";
								ajaxMessage.html('<p class="jseacgpSuccess">'+jseacgpD.aSmessage+' <a href="'+reqLocation+'">Click here</a> if download not started automatically.</p>');
								document.location = reqLocation;
							}

							if(rtype === 'form3'){
								var reqLocation = jseacgpD.ajaxUrl+"?action=jseacgp_pdfdl&generate=yes&roll="+roll+"";
								ajaxMessage.html('<p class="jseacgpSuccess">'+jseacgpD.aSmessage+' <a href="'+reqLocation+'">Click here</a> if download not started automatically.</p>');
								document.location = reqLocation;
							}

							if(rtype === 'form4'){
								var reqLocation = jseacgpD.ajaxUrl+"?action=jseacgp_pdfdl&generate=yes&reg="+reg+"";
								ajaxMessage.html('<p class="jseacgpSuccess">'+jseacgpD.aSmessage+' <a href="'+reqLocation+'">Click here</a> if download not started automatically.</p>');
								document.location = reqLocation;
							}

							if(rtype === 'form5'){
								var reqLocation = jseacgpD.ajaxUrl+"?action=jseacgp_pdfdl&generate=yes&birthdate="+birthdate+"";
								ajaxMessage.html('<p class="jseacgpSuccess">'+jseacgpD.aSmessage+' <a href="'+reqLocation+'">Click here</a> if download not started automatically.</p>');
								document.location = reqLocation;
							}

						}
						else{
							loader.hide();
							ajaxMessage.html('<p class="jseacgpError">'+jseacgpD.aEmessage+'</p>');
						}
						
					},
					
					// If error it will be executed
					
					error: function(XMLHttpRequest, textStatus, errorTown){
						alert(errorTown);
					},
					
					beforeSend: function(){
						ajaxMessage.html('');
						loader.show();
					},
					complete: function(){
						// 
					}
		  
				}); // End ajax
			}
			else{
				ajaxMessage.html('<p class="jseacgpError">Invalid date format.Enter date in dd/mm/yyyy format ONLY.</p>');
				return;
			}
			
		}) // End submit
	});
})( jQuery );